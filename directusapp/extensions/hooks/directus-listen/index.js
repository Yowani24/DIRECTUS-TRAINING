"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=t(require("crypto"));let e,r,l=t=>((t=>{!e||e.length<t?(e=Buffer.allocUnsafe(128*t),a.default.randomFillSync(e),r=0):r+t>e.length&&(a.default.randomFillSync(e),r=0),r+=t})(t-=0),e.subarray(r-t,r));const n=((t,a=21)=>((t,a,e)=>{let r=(2<<31-Math.clz32(t.length-1|1))-1,l=Math.ceil(1.6*r*a/t.length);return(n=a)=>{let s="";for(;;){let a=e(l),i=l;for(;i--;)if(s+=t[a[i]&r]||"",s.length===n)return s}}})(t,a,l))("1234567890abcdef",10);module.exports=({filter:t,action:a})=>{t("items.create",(async(t,a)=>{t.nano_id=await n()})),a("items.update",(async(t,a)=>{await async function(t,a){const e=a.database,r=t.payload.project_id;r?await e("projects").where("id",r).update({status:"published"}):await e("projects").where("vintage",null).update({status:"draft"})}(t,a),await async function(t,a){const e=a.database;t.payload.project_id,await e("safras").whereNull("project_id").update({status:"draft"}),await e("safras").whereNotNull("project_id").update({status:"published"})}(t,a)}))};
